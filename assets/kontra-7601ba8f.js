import{E as q}from"./engine-5f697a6b.js";let x=()=>{},D="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function Y(i,t){let e=t.parentNode;if(i.setAttribute("data-kontra",""),e){let s=e.querySelector("[data-kontra]:last-of-type")||t;e.insertBefore(i,s.nextSibling)}else document.body.appendChild(i)}function L(i,t){let e=i.indexOf(t);if(e!=-1)return i.splice(e,1),!0}let K={};function O(i,...t){(K[i]||[]).map(e=>e(...t))}let y,v,M={get(i,t){return t=="_proxy"?!0:x}};function g(){return v}function P(i,{contextless:t=!1}={}){if(y=document.getElementById(i)||i||document.querySelector("canvas"),t&&(y=y||new Proxy({},M)),!y)throw Error("You must provide a canvas element for the game");return v=y.getContext("2d")||new Proxy({},M),v.imageSmoothingEnabled=!1,O("init"),{canvas:y,context:v}}class ${constructor({spriteSheet:t,frames:e,frameRate:s,loop:h=!0}){this.spriteSheet=t,this.frames=e,this.frameRate=s,this.loop=h;let{width:r,height:n,margin:a=0}=t.frame;this.width=r,this.height=n,this.margin=a,this._f=0,this._a=0}clone(){return new $(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(!(!this.loop&&this._f==this.frames.length-1))for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:s=this.width,height:h=this.height,context:r=g()}){let n=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,a*this.width+(a*2+1)*this.margin,n*this.height+(n*2+1)*this.margin,this.width,this.height,t,e,s,h)}}function T(){return new $(...arguments)}function z(i,t){let e=Math.sin(t),s=Math.cos(t);return{x:i.x*s-i.y*e,y:i.x*e+i.y*s}}function I(i,t,e){return i*(1-e)+t*e}function R(i,t,e){return Math.min(Math.max(i,e),t)}function B(i,t){return[i,t]=[i,t].map(e=>N(e)),i.x<t.x+t.width&&i.x+i.width>t.x&&i.y<t.y+t.height&&i.y+i.height>t.y}function N(i){let{x:t=0,y:e=0,width:s,height:h}=i.world||i;return i.mapwidth&&(s=i.mapwidth,h=i.mapheight),i.anchor&&(t-=s*i.anchor.x,e-=h*i.anchor.y),s<0&&(t+=s,s*=-1),h<0&&(e+=h,h*=-1),{x:t,y:e,width:s,height:h}}class _{constructor(t=0,e=0,s={}){this.x=t,this.y=e,s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=e)}add(t){return new _(this.x+t.x,this.y+t.y,this)}subtract(t){return new _(this.x-t.x,this.y-t.y,this)}scale(t){return new _(this.x*t,this.y*t)}normalize(t=this.length()){return new _(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,s,h){this._c=!0,this._a=t,this._b=e,this._d=s,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?R(this._a,this._d,t):t}set y(t){this._y=this._c?R(this._b,this._e,t):t}}function k(){return new _(...arguments)}class G{constructor(t){return this.init(t)}init(t={}){this.position=k(),this.velocity=k(),this.acceleration=k(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class X extends G{init({width:t=0,height:e=0,context:s=g(),render:h=this.draw,update:r=this.advance,children:n=[],anchor:a={x:0,y:0},opacity:d=1,rotation:c=0,scaleX:o=1,scaleY:u=1,...f}={}){this._c=[],super.init({width:t,height:e,context:s,anchor:a,opacity:d,rotation:c,scaleX:o,scaleY:u,...f}),this._di=!0,this._uw(),this.addChild(n),this._rf=h,this._uf=r}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(e||s)&&t.translate(e,s),this.context.globalAlpha=this.opacity,this._rf(),(e||s)&&t.translate(-e,-s),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:s=1,_wr:h=0,_wsx:r=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=h+this.rotation;let{x:a,y:d}=z({x:this._wx,y:this._wy},h);this._wx=a,this._wy=d,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||x,e._pc()})}removeChild(...t){t.flat().map(e=>{L(this.children,e)&&(e.parent=null,e._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function U(){return new X(...arguments)}class W extends X{init({image:t,width:e=t?t.width:void 0,height:s=t?t.height:void 0,...h}={}){super.init({image:t,width:e,height:s,...h})}get animations(){return this._a}set animations(t){let e,s;this._a={};for(e in t)this._a[e]=t[e].clone(),s=s||this._a[e];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function J(){return new W(...arguments)}let Q=/(\d+)(\w+)/;function Z(i){let t=i.match(Q),e=+t[1],s=t[2];return{size:e,unit:s,computed:e}}class V extends X{init({text:t="",textAlign:e="",lineHeight:s=1,font:h=g().font,...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:s,font:h,...r}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Z(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),s=0,h=2;for(;h<=e.length;h++){let r=e.slice(s,h).join(" ");t.measureText(r).width>this._fw&&(this._s.push(e.slice(s,h-1).join(" ")),s=h-1)}this._s.push(e.slice(s,h).join(" "))}if(!this._s.length&&this.text.includes(`
`)){let e=0;this.text.split(`
`).map(s=>{this._s.push(s),e=Math.max(e,t.measureText(s).width)}),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,s=this.context;e=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((h,r)=>{s.textBaseline="top",s.textAlign=e,s.fillStyle=this.color,s.font=this.font,s.fillText(h,t,this._fs*this.lineHeight*r)})}}function j(){return new V(...arguments)}function tt(i){let t=i.canvas;i.clearRect(0,0,t.width,t.height)}function et({fps:i=60,clearCanvas:t=!0,update:e=x,render:s,context:h=g(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let n=0,a=1e3/i,d=1/i,c=t?tt:x,o,u,f,m,p,S=!0;r||(window.addEventListener("focus",()=>{S=!0}),window.addEventListener("blur",()=>{S=!1}));function E(){if(u=requestAnimationFrame(E),!!S&&(f=performance.now(),m=f-o,o=f,!(m>1e3))){for(O("tick"),n+=m;n>=a;)p.update(d),n-=a;c(h),p.render()}}return p={update:e,render:s,isStopped:!0,start(){o=performance.now(),this.isStopped=!1,requestAnimationFrame(E)},stop(){this.isStopped=!0,cancelAnimationFrame(u)},_frame:E,set _last(b){o=b}},p}let it={},st={},A={},w={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function F(i=x,t){i._pd&&t.preventDefault(),i(t)}function ht(i){let t=w[i.code],e=it[t];A[t]=!0,F(e,i)}function rt(i){let t=w[i.code],e=st[t];A[t]=!1,F(e,i)}function nt(){A={}}function at(){let i;for(i=0;i<26;i++)w["Key"+String.fromCharCode(i+65)]=String.fromCharCode(i+97);for(i=0;i<10;i++)w["Digit"+i]=w["Numpad"+i]=""+i;window.addEventListener("keydown",ht),window.addEventListener("keyup",rt),window.addEventListener("blur",nt)}function l(i){return!!A[i]}function C(i){let t=[];return i._dn?t.push(i._dn):i.children&&i.children.map(e=>{t=t.concat(C(e))}),t}class ot{constructor({id:t,name:e=t,objects:s=[],context:h=g(),cullObjects:r=!0,cullFunction:n=B,sortFunction:a,...d}){this._o=[];let c=h.canvas,o=this._dn=document.createElement("section");o.tabIndex=-1,o.style=D,o.id=t,o.setAttribute("aria-label",e),Y(o,c),Object.assign(this,{id:t,name:e,context:h,cullObjects:r,cullFunction:n,sortFunction:a,...d});let{width:u,height:f}=c,m=u/2,p=f/2;this.camera=U({x:m,y:p,width:u,height:f,context:h,centerX:m,centerY:p,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(s)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),C(e).map(s=>{this._dn.appendChild(s)})})}remove(...t){t.flat().map(e=>{L(this._o,e),C(e).map(s=>{Y(s,this.context)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:s}=t.world||t;this.camera.x=e,this.camera.y=s}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:s,_sy:h,camera:r,sortFunction:n,cullObjects:a,cullFunction:d}=this;e.translate(s,h);let c=t;a&&(c=c.filter(o=>d(r,o))),n&&c.sort(n),c.map(o=>o.render&&o.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:s,y:h,centerX:r,centerY:n}=e;t.save(),this._sx=r-s,this._sy=n-h,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function lt(){return new ot(...arguments)}function ct(i){if(+i==i)return i;let t=[],e=i.split(".."),s=+e[0],h=+e[1],r=s;if(s<h)for(;r<=h;r++)t.push(r);else for(;r>=h;r--)t.push(r);return t}class dt{constructor({image:t,frameWidth:e,frameHeight:s,frameMargin:h,animations:r}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:s,margin:h},this._f=t.width/e|0,this.createAnimations(r)}createAnimations(t){let e,s;for(s in t){let{frames:h,frameRate:r,loop:n}=t[s];if(e=[],h==null)throw Error("Animation "+s+" must provide a frames property");[].concat(h).map(a=>{e=e.concat(ct(a))}),this.animations[s]=T({spriteSheet:this,frames:e,frameRate:r,loop:n})}}}function ft(){return new dt(...arguments)}const ut=3,H=3;class pt extends q{constructor(){super()}init(){const{context:t}=P();this.ctx=t,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1,this.sprite=new Image,this.sprite.src="spritesheet.png",this.sprite.onload=()=>{this.spritesheet=ft({image:this.sprite,frameWidth:this.texture.width,frameHeight:this.texture.height,animations:{idle:{frames:"0..10",frameRate:10,loop:!0},run:{frames:"11..22",frameRate:20,loop:!0}}}),this.player=J({x:0,y:0,width:this.texture.width*H,height:this.texture.height*H,anchor:{x:.5,y:.5},animations:this.spritesheet.animations}),this.player.movement={left:!1,up:!1,right:!1,down:!1},this.scene=lt({id:"game",objects:[this.player]}),this.text=j({text:this.getSpriteInfo(),font:"32px Arial",color:"white",x:15,y:15}),this.camera={x:this.player.x,y:this.player.y},at()}}getSpriteInfo(){return`
State: ${this.player.state}
Frame: ${this.player.currentAnimation.frames[0]+this.player.currentAnimation._f}
Pos: ${Math.round(this.player.x)},${Math.round(this.player.y)}`.trim()}checkKeys(){(l("arrowleft")||l("a"))&&(this.player.movement.left=!0,this.player.facing=0),(l("arrowup")||l("w"))&&(this.player.movement.up=!0),(l("arrowright")||l("d"))&&(this.player.movement.right=!0,this.player.facing=1),(l("arrowdown")||l("s"))&&(this.player.movement.down=!0),l("arrowleft")||l("a")||(this.player.movement.left=!1),l("arrowup")||l("w")||(this.player.movement.up=!1),l("arrowright")||l("d")||(this.player.movement.right=!1),l("arrowdown")||l("s")||(this.player.movement.down=!1)}render(){this.loop=et({update:()=>{if(!this.scene)return;this.checkKeys(),this.camera.x=I(this.camera.x,this.player.x,.03),this.camera.y=I(this.camera.y,this.player.y,.03),this.scene.lookAt(this.camera),this.player.update();let t=ut;const e=Object.values(this.player.movement).filter(s=>s).length;e>1&&(t*=.71),this.player.movement.left&&(this.player.x-=t),this.player.movement.up&&(this.player.y-=t),this.player.movement.right&&(this.player.x+=t),this.player.movement.down&&(this.player.y+=t),this.player.movement.left?(this.player.facing=0,this.player.scaleX=-1):this.player.movement.right&&(this.player.facing=1,this.player.scaleX=1),this.player.state!=="idle"&&e===0?(this.player.state="idle",this.player.playAnimation("idle")):this.player.state!=="run"&&e>0&&(this.player.state="run",this.player.playAnimation("run"))},render:()=>{this.scene&&(this.scene.render(),this.text.render(),this.text.text=this.getSpriteInfo())}}),this.loop.start()}}document.addEventListener("DOMContentLoaded",()=>{const i=new pt;i.init(),i.render()});
